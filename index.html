<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Aggregation Program (RAP)</title>
    <link rel="icon" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3e%3ccircle cx='12' cy='12' r='10' fill='%23eff6ff' stroke='%233b82f6' stroke-width='1.5' /%3e%3cpath d='M11.05,18.5 L13.05,14.5 L10,14.5 L13,6.5 L15,10.5 L18,10.5 L11.05,18.5 Z' fill='%2322c55e' /%3e%3c/svg%3e">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


    <style>
        /* Custom styles to enhance the look and feel */
        body {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth;
        }
        .hero-gradient {
            background: linear-gradient(135deg, #1d4ed8, #3b82f6);
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 5px;
            outline: none;
            opacity: 0.8;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            background: #2563eb;
            cursor: pointer;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        /* Tab styling */
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            border-color: #2563eb;
            color: #2563eb;
            background-color: #eff6ff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        /* Input type toggle */
        .input-type-label {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            transition: all 0.2s ease-in-out;
        }
        input[type="radio"]:checked + .input-type-label {
            background-color: #eff6ff;
            border-color: #2563eb;
            color: #1d4ed8;
            font-weight: 600;
        }
        /* Custom scrollbar for tab navigation */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* FAQ Accordion */
        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        /* Notification Modal */
        #notification-modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <nav class="container mx-auto px-4 sm:px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
                </svg>
                <span class="text-lg sm:text-xl font-bold text-gray-800">Retail Aggregation Program (RAP)</span>
            </div>
            <div>
                <a href="#calculator" class="bg-blue-600 text-white font-semibold px-4 py-2 sm:px-5 rounded-lg hover:bg-blue-700 transition-colors text-sm sm:text-base">Get Started</a>
            </div>
        </nav>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero-gradient text-white">
            <div class="container mx-auto px-4 sm:px-6 py-16 sm:py-20 text-center">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-extrabold mb-4">A smarter way to buy electricity.</h1>
                <p class="text-base sm:text-lg md:text-xl max-w-3xl mx-auto mb-8">
                    Check your eligibility, find suppliers, and calculate your potential savings with the Retail Aggregation Program (RAP).
                </p>
            </div>
        </section>

        <!-- Main Content Section with Tabs -->
        <section id="calculator" class="py-12 sm:py-16 lg:py-24">
            <div class="container mx-auto px-4 sm:px-6">
                <!-- Tab Navigation -->
                <div class="mb-8 border-b border-gray-200 tab-navigation">
                    <nav class="-mb-px flex space-x-4 sm:space-x-6 overflow-x-auto no-scrollbar" aria-label="Tabs">
                        <button class="tab-button active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base sm:text-lg" data-tab="eligibility">1. Check Eligibility</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base sm:text-lg text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="suppliers">2. Find Suppliers</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base sm:text-lg text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="savings">3. Calculate Savings</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base sm:text-lg text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="compare">4. Compare Suppliers</button>
                        <button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-base sm:text-lg text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="faq">FAQ & Info</button>
                    </nav>
                </div>

                <!-- Tab Content -->
                <div>
                    <!-- Eligibility Checker Tab -->
                    <div id="eligibility-content" class="tab-content active">
                        <div class="card p-4 sm:p-6 lg:p-8 max-w-4xl mx-auto">
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Are You Eligible for Aggregation?</h2>
                            <p class="text-gray-600 mt-2 mb-8">The primary requirement for the Retail Aggregation Program is meeting a combined peak demand. Enter your group's details to see if you qualify.</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                                <div class="space-y-6">
                                    <div>
                                        <label for="eligibility-members" class="block text-sm font-medium text-gray-700">Number of Members in Group</label>
                                        <input type="range" id="eligibility-members" min="2" max="200" value="10" class="mt-1">
                                        <div class="text-right font-semibold text-blue-600"><span id="eligibility-members-value">10</span> members</div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Type</label>
                                        <div class="flex items-center space-x-4">
                                            <input type="radio" id="customer-type-res" name="customerType" value="residential" class="hidden" checked>
                                            <label for="customer-type-res" class="input-type-label">Residential</label>
                                            <input type="radio" id="customer-type-nonres" name="customerType" value="non-residential" class="hidden">
                                            <label for="customer-type-nonres" class="input-type-label">Non-Residential</label>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Input Type</label>
                                        <div class="flex items-center space-x-4">
                                            <input type="radio" id="input-type-kw" name="inputType" value="kw" class="hidden" checked>
                                            <label for="input-type-kw" class="input-type-label">Peak Demand (kW)</label>
                                            <input type="radio" id="input-type-kwh" name="inputType" value="kwh" class="hidden">
                                            <label for="input-type-kwh" class="input-type-label">Consumption (kWh)</label>
                                        </div>
                                    </div>

                                    <div id="kw-input-container">
                                        <label for="peak-demand" class="block text-sm font-medium text-gray-700">Average Monthly Peak Demand per Member (kW)</label>
                                        <input type="number" id="peak-demand" value="5" step="0.5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                        <p class="mt-1 text-xs text-gray-500">Your highest electrical demand in a month.</p>
                                    </div>

                                    <div id="kwh-input-container" class="hidden space-y-6">
                                        <div id="industry-type-container" class="hidden">
                                            <label for="industry-type" class="block text-sm font-medium text-gray-700">Select Industry</label>
                                            <select id="industry-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                                <!-- Options will be populated by JS -->
                                            </select>
                                        </div>
                                        <div>
                                            <label for="monthly-consumption" class="block text-sm font-medium text-gray-700">Average Monthly Consumption per Member (kWh)</label>
                                            <input type="number" id="monthly-consumption" value="400" step="50" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                            <p class="mt-1 text-xs text-gray-500">Enter your total energy consumption from your monthly electric bill.</p>
                                        </div>
                                    </div>

                                    <button id="check-eligibility-btn" class="w-full bg-blue-600 text-white font-semibold px-5 py-3 rounded-lg hover:bg-blue-700 transition-colors">Check Eligibility</button>
                                </div>
                                <div id="eligibility-result" class="bg-gray-50 p-6 rounded-lg text-center hidden md:sticky md:top-24">
                                    <!-- Result will be injected here -->
                                </div>
                            </div>
                        </div>
                        <div class="max-w-4xl mx-auto mt-12 text-gray-600">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Disclaimer:</h3>
                            <p class="mb-6">This estimated power demand can be used as an easy reference for assessing RAP eligibility but will not be the actual basis for application.</p>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">Interested to join the Retail Aggregation Program?</h3>
                            <ol class="list-decimal list-inside space-y-2">
                                <li>Form an Aggregated Group and participate in the RAP to meet the minimum demand requirement of 500 kW. Aggregation is allowed within any of the following geographical locations: i. Subdivisions; ii. Villages; iii. Business Districts; iv. Special Economic Zones; and v. Such other location in which supply of electricity of similarity situated End-users can be measured through metering devices.</li>
                                <li>Visit the <a href="https://buyyourelectricity.erc.ph/RES-Options" target="_blank" class="text-blue-600 hover:underline">https://buyyourelectricity.erc.ph/RES-Options</a> website to know more about the program and have a handy list of available Retail Suppliers/Retail Aggregators to which you may express your intent to join.</li>
                            </ol>
                        </div>
                    </div>

                    <!-- Supplier Directory Tab -->
                    <div id="suppliers-content" class="tab-content">
                        <div class="card p-4 sm:p-6 lg:p-8">
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Retail Electricity Supplier (RES) Directory</h2>
                            <p class="text-gray-600 mt-2 mb-8">Browse licensed suppliers. The rates shown are average prices and for estimation only. Click "Use Rate" to add it to the Savings Calculator.</p>
                            <div class="flex flex-wrap gap-4 mb-6">
                                <div>
                                    <label for="sort-suppliers" class="block text-sm font-medium text-gray-700">Sort By</label>
                                    <select id="sort-suppliers" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                        <option value="price">Price</option>
                                        <option value="name">Name</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="filter-standing" class="block text-sm font-medium text-gray-700">ERC Standing</label>
                                    <select id="filter-standing" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                        <option value="all">All</option>
                                        <option value="Very Satisfactory">Very Satisfactory</option>
                                        <option value="Satisfactory">Satisfactory</option>
                                    </select>
                                </div>
                            </div>
                            <div id="supplier-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                <!-- Supplier cards will be injected here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Savings Calculator Tab -->
                    <div id="savings-content" class="tab-content">
                        <div class="bg-white rounded-lg shadow-xl overflow-hidden" id="savings-report-area">
                            <div class="grid grid-cols-1 lg:grid-cols-5">
                                <div class="lg:col-span-2 p-4 sm:p-6 lg:p-8">
                                    <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Estimate Your Group's Savings</h2>
                                    <div id="savings-eligibility-status" class="mt-4 mb-6 p-4 rounded-lg text-center font-semibold">
                                        <!-- Status message will be injected here -->
                                    </div>
                                    
                                    <form id="savings-form" class="space-y-6">
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <p class="text-sm font-medium text-gray-700">Group Members</p>
                                                <p id="savings-members-display" class="text-lg font-bold text-blue-600">10</p>
                                            </div>
                                            <div>
                                                <p class="text-sm font-medium text-gray-700">Avg. Monthly Consumption (kWh)</p>
                                                <p id="savings-consumption-display" class="text-lg font-bold text-blue-600">400</p>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label for="du-select" class="block text-sm font-medium text-gray-700">Select Your Distribution Utility (DU)</label>
                                            <select id="du-select" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
                                            <p id="du-data-month" class="mt-1 text-xs text-gray-500"></p>
                                        </div>

                                        <div>
                                            <label for="current-rate" class="block text-sm font-medium text-gray-700">DU Generation Rate (PhP/kWh)</label>
                                            <input type="number" id="current-rate" name="current-rate" value="6.02" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label for="new-rate" class="block text-sm font-medium text-gray-700">Potential Aggregated Rate (PHP / kWh)</label>
                                            <input type="number" id="new-rate" name="new-rate" value="9.80" step="0.01" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                        </div>
                                    </form>
                                </div>
                                <div class="lg:col-span-3 bg-gray-50 p-4 sm:p-6 lg:p-8 flex flex-col justify-center">
                                    <div class="w-full">
                                        <div class="text-center mb-6">
                                            <h3 class="text-sm font-medium text-gray-700 uppercase tracking-wider">Potential Total Annual Savings</h3>
                                            <p id="annual-savings" class="text-4xl sm:text-5xl lg:text-6xl font-extrabold text-green-600 mt-1">₱0.00</p>
                                        </div>
                                        <div class="relative h-64 md:h-72 w-full max-w-md mx-auto mb-6">
                                            <canvas id="savingsChart"></canvas>
                                        </div>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                                                <p class="text-sm text-gray-500">Total Monthly Savings</p>
                                                <p id="monthly-savings" class="text-xl sm:text-2xl font-bold text-gray-800">₱0.00</p>
                                            </div>
                                            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                                                <p class="text-sm text-gray-500">Avg. Savings per Member</p>
                                                <p id="member-savings" class="text-xl sm:text-2xl font-bold text-gray-800">₱0.00</p>
                                            </div>
                                        </div>
                                        <div id="negative-savings-recommendation" class="mt-6 hidden">
                                            <!-- Recommendation will be injected here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card p-4 sm:p-6 lg:p-8 mt-8">
                            <h3 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4">Advanced Savings Projections</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div>
                                    <label for="projection-period" class="block text-sm font-medium text-gray-700">Projection Period</label>
                                    <select id="projection-period" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                                    </select>
                                </div>
                                <div>
                                    <label for="annual-increase" class="block text-sm font-medium text-gray-700">DU Generation Rate Annual Increase</label>
                                    <select id="annual-increase" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
                                </div>
                            </div>
                            <div id="projection-results"></div>
                        </div>
                         <div class="text-center mt-8">
                            <button id="print-savings-report-btn" class="bg-green-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                Print / Export Report
                            </button>
                        </div>
                    </div>
                    <!-- Compare Suppliers Tab -->
                    <div id="compare-content" class="tab-content">
                        <div class="card p-4 sm:p-6 lg:p-8 max-w-6xl mx-auto" id="compare-report-area">
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900">Compare Suppliers</h2>
                            <p class="text-gray-600 mt-2 mb-8">Select up to three suppliers to compare their potential savings for your group.</p>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-x-6 gap-y-4 mb-6">
                                <div>
                                    <label for="supplier1" class="block text-sm font-medium text-gray-700">Supplier 1</label>
                                    <select id="supplier1" class="compare-supplier-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
                                </div>
                                <div>
                                    <label for="supplier2" class="block text-sm font-medium text-gray-700">Supplier 2</label>
                                    <select id="supplier2" class="compare-supplier-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
                                </div>
                                <div>
                                    <label for="supplier3" class="block text-sm font-medium text-gray-700">Supplier 3</label>
                                    <select id="supplier3" class="compare-supplier-select mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"></select>
                                </div>
                            </div>
                            <button id="compare-suppliers-btn" class="w-full sm:w-auto bg-blue-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors">Compare Selected Suppliers</button>

                            <div id="comparison-results" class="mt-8"></div>
                            
                            <div id="top-3-recommendation" class="mt-12">
                                <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-4">Top 3 Recommended Suppliers</h3>
                                <div id="top-3-list" class="space-y-4"></div>
                            </div>
                            
                            <div id="final-recommendation" class="mt-8 p-4 bg-green-50 border-l-4 border-green-400 hidden"></div>
                        </div>
                         <div class="text-center mt-8">
                            <button id="print-compare-report-btn" class="bg-green-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                Print / Export Comparison
                            </button>
                        </div>
                    </div>
                    <!-- FAQ & Info Tab -->
                    <div id="faq-content" class="tab-content">
                         <div class="max-w-4xl mx-auto">
                            <!-- Explainer Panel -->
                            <div class="card p-4 sm:p-6 lg:p-8 mb-12">
                                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4">What is the Retail Aggregation Program?</h2>
                                <div class="space-y-4 text-gray-600">
                                    <p>The Retail Aggregation Program (RAP) allows a group of end-users within a specific area to pool their electricity demand to meet the 500kW minimum requirement to be part of the Contestable Market. This gives them the power to choose their own Retail Electricity Supplier (RES).</p>
                                    <p>By combining their demand, smaller businesses and consumers can gain access to competitive electricity prices and services that were previously only available to large industrial or commercial users. This program is designed to promote consumer choice, encourage competition among electricity suppliers, and ultimately lead to better rates and services for more Filipinos.</p>
                                    <p>An Aggregator, who is a licensed RES, acts on behalf of the group to negotiate with power generators and manage their electricity supply contract.</p>
                                </div>
                            </div>
                            
                            <!-- Glossary Panel -->
                            <div class="card p-4 sm:p-6 lg:p-8 mb-12">
                                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4">Glossary of Terms</h2>
                                <div id="glossary-list" class="space-y-4 text-gray-600">
                                    <!-- Glossary terms will be injected here -->
                                </div>
                            </div>

                            <!-- FAQ Panel -->
                            <div>
                                <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6 text-center">Frequently Asked Questions (FAQ)</h2>
                                <div id="faq-accordion" class="space-y-4">
                                    <!-- FAQ items will be injected here by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
        <div class="bg-gray-900">
            <div class="container mx-auto px-4 sm:px-6 py-8 text-center text-gray-400">
                <p>&copy; 2025 Retail Aggregation Program (RAP). All rights reserved.</p>
                <p class="text-sm mt-2">This tool is for estimation purposes only. It is based on the principles of the Retail Aggregation Program under the ERC's Omnibus Rules. For official information, please refer to the <a href="https://www.erc.gov.ph" target="_blank" class="underline hover:text-blue-400">Energy Regulatory Commission (ERC)</a>.</p>
            </div>
        </div>
    </footer>
    
    <!-- Notification Modal -->
    <div id="notification-modal" class="fixed bottom-5 right-5 bg-green-500 text-white py-3 px-6 rounded-lg shadow-lg opacity-0 transform translate-y-10 pointer-events-none">
        <p id="notification-message"></p>
    </div>


    <script>
        // --- DATA INITIALIZATION ---
        const supplierData = [
            { name: "Team (Phils.) Energy Corp.", price: 3.6, contact: "Not Available", standing: "Satisfactory" },
            { name: "EEI Energy Solutions Corporation", price: 3.53, contact: "(+632) 334-2677", standing: "Very Satisfactory" },
            { name: "Clark Electric Distribution Corporation Local RES", price: 3.62, contact: "(045) 599-3146", standing: "Very Satisfactory" },
            { name: "Shell Energy Philippines, Inc.", price: 3.64, contact: "Not Available", standing: "Satisfactory" },
            { name: "Green Core Geothermal, Inc.", price: 3.68, contact: "(+632) 7755-2332", standing: "Very Satisfactory" },
            { name: "Anda Power Corporation", price: 3.69, contact: "0917-324-6961", standing: "Satisfactory" },
            { name: "Mabuhay Energy Corporation", price: 3.69, contact: "Not Available", standing: "Satisfactory" },
            { name: "Ecozone Power Management, Inc.", price: 3.75, contact: "(632) 8884-1106", standing: "Very Satisfactory" },
            { name: "SEM - Calaca Power RES, Inc.", price: 3.76, contact: "Not Available", standing: "Satisfactory" },
            { name: "First Gen Energy Solutions, Inc.", price: 3.79, contact: "(632) 3449-6400", standing: "Very Satisfactory" },
            { name: "KEPCO SPC Power Corporation", price: 3.8, contact: "(032) 8810-4474", standing: "Satisfactory" },
            { name: "Bac-Man Geothermal, Inc.", price: 3.81, contact: "(+632) 7755-2332", standing: "Very Satisfactory" },
            { name: "Batangas II Electric Cooperative, Inc. Local RES", price: 3.89, contact: "(043) 756-1424", standing: "Satisfactory" },
            { name: "SN Aboitiz Power-Magat. Inc.", price: 3.91, contact: "Not Available", standing: "Satisfactory" },
            { name: "PRISM Energy, Inc.", price: 4.12, contact: "Not Available", standing: "Satisfactory" },
            { name: "SN Aboitiz Power-RES Corp.", price: 4.22, contact: "Not Available", standing: "Very Satisfactory" },
            { name: "Corenergy, Inc.", price: 4.27, contact: "+639178750294", standing: "Satisfactory" },
            { name: "Citicore Energy Solutions, Inc.", price: 4.32, contact: "(02) 470-8998", standing: "Very Satisfactory" },
            { name: "DirectPower Services, Inc.", price: 4.41, contact: "+632 7955-7065", standing: "Very Satisfactory" },
            { name: "MeridianX, Inc.", price: 4.46, contact: "Not Available", standing: "Satisfactory" },
            { name: "AdventEnergy, Inc.", price: 4.5, contact: "+63 939 914 1950", standing: "Satisfactory" },
            { name: "Global Energy Supply Corporation", price: 4.63, contact: "(02) 8464-1600", standing: "Very Satisfactory" },
            { name: "Kratos RES Inc.", price: 4.98, contact: "(02) 5310-7284", standing: "Satisfactory" },
            { name: "AC Energy and Infrastructure Corporation", price: 5.1, contact: "+(632) 7-730-6300", standing: "Very Satisfactory" },
            { name: "Vantage Energy Solutions and Management, Inc.", price: 5.11, contact: "Not Available", standing: "Satisfactory" },
            { name: "FDC Retail Electricity Sales Corp.", price: 5.4, contact: "(02) 8636-6486", standing: "Very Satisfactory" },
            { name: "Aboitiz Energy Solutions, Inc.", price: 5.54, contact: "+63 (2) 886-2800", standing: "Very Satisfactory" },
            { name: "ACEN Corporation", price: 6.77, contact: "(02) 7730-6300", standing: "Very Satisfactory" },
            { name: "Manila Electric Company Local RES", price: 6.81, contact: "Not Available", standing: "Very Satisfactory" },
            { name: "Solar Philippines Retail Electricity, Inc.", price: 6.84, contact: "Not Available", standing: "Satisfactory" },
            { name: "GNPower Ltd. Co.", price: 7.44, contact: "(02) 638-4542", standing: "Satisfactory" },
            { name: "SMC Consolidated Power Corporation", price: 7.62, contact: "Not Available", standing: "Very Satisfactory" },
            { name: "Masinloc Power Partners Co., Ltd.", price: 8.49, contact: "Not Available", standing: "Satisfactory" }
        ];

        const industryLoadFactors = {
            "Accommodations": 0.5, "Agriculture, Animal Husbandry": 0.3, "Arts, Culture and Recreation": 0.3, "Banking and Finance": 0.4,
            "Computer, Electronic and Optical Products": 0.4, "Construction and Engineering": 0.3, "Education Services": 0.5, "Government Administration": 0.5,
            "Health and Medical Services": 0.2, "Health and Social Services": 0.5, "Land, Water, Air Transportation and other related services": 0.5,
            "Leather Processing and related products": 0.5, "Manufacture and Repair of Furniture": 0.4, "Manufacture of Chemicals and chemical products": 0.3,
            "Manufacture of Coke and Refined Petroleum Products": 0.3, "Manufacture of Computer, Electronic and Optical Products": 0.3,
            "Manufacture of Electrical Equipment": 0.4, "Manufacture of Fabricated Metal Products": 0.4, "Manufacture of Food Products and Beverages": 0.3,
            "Manufacture of Glass and Glass Products": 0.2, "Manufacture of Leather and related products": 0.3, "Manufacture of Machinery and equipment n.e.c.": 0.3,
            "Manufacture of Motor Vehicles, trailers and semi-trailers": 0.3, "Manufacture of Non-metallic mineral products": 0.4,
            "Manufacture of Paper and paper products": 0.5, "Manufacture of Pharmaceutical products, medicinal chemical and botanical products": 0.2,
            "Manufacture of Rubber and plastic products": 0.3, "Manufacture of Rubber products": 0.2, "Manufacture of Textiles and wearing apparel": 0.3,
            "Manufacture of Tobacco products": 0.3, "Manufacture of Transport equipment": 0.5, "Manufacture of Wood and products of wood and cork": 0.3,
            "Manufacturing of Basic metals": 0.3, "Manufacturing of Other non-metallic mineral products": 0.2, "Manufacturing of Other transport equipment": 0.5,
            "Manufacturing of Printing and reproduction of recorded media": 0.4, "Manufacturing of Wearing apparel": 0.4, "Membership and other organizations": 0.5,
            "Metallic and Non-metallic ore mining": 0.3, "Miscellaneous Business Activities": 0.4, "Miscellaneous Service Activities": 0.4,
            "Motor Vehicle Maintenance and Repair": 0.3, "Motor Vehicle Transportation and Storage": 0.5, "Other Recreational and personal services": 0.5,
            "Private households with employed persons": 0.3, "Publishing, Printing and Broadcasting Activities": 0.3, "Real Estate Activities": 0.4,
            "Recycling, Waste Management and other related services": 0.4, "Restaurants, Bars, and Canteens": 0.5, "Retail or Wholesale of Motor Vehicles": 0.5,
            "Retail Trade": 0.3, "Streetlight": 0.3, "Transport and Logistics": 0.5,
            "Undifferentiated goods and services-producing activities of households for own use": 0.5, "Water, Electricity, Gas, and other related services": 0.3,
            "Wholesale Trade": 0.3
        };

        const faqData = [
            { question: "What is Retail Competition and Open Access (RCOA)?", answer: "RCOA is a policy mandated by the Electric Power Industry Reform Act (EPIRA) that allows electricity end-users who meet a certain demand threshold to choose their own Retail Electricity Supplier (RES). This promotes competition and gives consumers more options." },
            { question: "What is the Retail Aggregation Program (RAP)?", answer: "The RAP allows smaller electricity users to group together to meet the minimum demand threshold required for RCOA. This enables them to participate in the competitive market and choose their own supplier, which they couldn't do individually." },
            { question: "Who is eligible to join the RAP?", answer: "End-users who are located in a contiguous area (like a subdivision, village, or business district) and whose combined average monthly peak demand is at least 500 kW can form a group to join the RAP." },
            { question: "What is a 'Contiguous Area'?", answer: "It refers to a geographically defined area like a subdivision, village, special economic zone, or business district where the electricity supply of the members can be measured. It can also include condominium buildings or commercial complexes." },
            { question: "Who is a Retail Electricity Supplier (RES)?", answer: "A RES is a company licensed by the Energy Regulatory Commission (ERC) to sell, broker, or market electricity to eligible end-users in the competitive retail market." },
            { question: "What is a Retail Aggregator?", answer: "A Retail Aggregator is a licensed RES that consolidates the electricity demand of multiple end-users to purchase and resell electricity to them as a group." },
            { question: "How does our group switch to a new supplier under RAP?", answer: "Your chosen Retail Aggregator will handle the switching process. This involves submitting a switch request to the Central Registration Body (CRB) after all necessary contracts (like the Retail Supply Contract) are in place." },
            { question: "Can one member's non-payment affect the entire group?", answer: "No. An aggregated member shall not be prejudiced by the non-payment of another member. Disconnection for non-payment will only be implemented on the specific erring member, not the entire group." },
            { question: "What happens if our group's total demand falls below the threshold?", answer: "If the group's demand consistently falls below the threshold, you may need to revert to being a captive customer of your local Distribution Utility (DU) after your contract with the RES expires, subject to ERC rules." },
            { question: "Will we receive one bill for the entire group?", answer: "Typically, each member of the aggregated group will receive an individual billing statement from the Retail Supplier. The billing arrangement should be clearly stated in your Retail Supply Contract (RSC)." },
            { question: "Can we switch back to our old Distribution Utility (DU)?", answer: "Reverting to the captive market is generally not allowed once you switch to the competitive market. However, there are specific conditions under which it may be permitted, such as a significant and sustained drop in demand, subject to ERC approval." },
            { question: "What are the benefits of joining the RAP?", answer: "The main benefits include access to competitive pricing, the ability to negotiate contract terms, potential savings on electricity costs, and access to value-added services offered by different Retail Electricity Suppliers." },
            { question: "Is there a limit to the number of members in an aggregated group?", answer: "No, there is no limit on the number of members, as long as their combined demand meets the prevailing threshold (currently 500 kW) and they are located within a contiguous area." },
            { question: "Where can I get more information or file a complaint?", answer: "For more information or to address concerns, you can contact the Energy Regulatory Commission (ERC). You may call their trunk line at (02) 8689-5372 and ask for the Retail Market Division." }
        ];
        
        const glossaryData = {
            "Distribution Utility (DU)": "The company responsible for the distribution of electricity to end-users in a specific franchise area (e.g., Meralco, VECO).",
            "Contestable Market": "The portion of the electricity market where eligible customers (Contestable Customers) can choose their own Retail Electricity Supplier (RES).",
            "Retail Electricity Supplier (RES)": "A company licensed by the ERC to sell, broker, or market electricity to the Contestable Market.",
            "Retail Aggregator": "A licensed RES that combines the demand of multiple smaller end-users to meet the contestability threshold, acting as their single supplier.",
            "Load Factor": "A measure of the efficiency of electricity usage. It is the ratio of average demand to peak demand over a period. A higher load factor generally means more efficient energy use.",
            "Peak Demand (kW)": "The highest amount of electrical power (measured in kilowatts) that a customer or group demands from the grid at any one time during a billing period.",
            "Energy Consumption (kWh)": "The total amount of electricity (measured in kilowatt-hours) used over a period of time. It's what you're primarily billed for on your electric bill."
        };

        const duData = {
            "MERALCO": { rate: 7.36, month: "June 2025" },
            "AEC": { rate: 5.63, month: "June 2025" },
            "CEDC": { rate: 3.88, month: "June 2025" },
            "CELCOR": { rate: 5.65, month: "July 2025" },
            "DECORP": { rate: 4.67, month: "July 2025" },
            "IEEC": { rate: 4.07, month: "June 2025" },
            "LUECO": { rate: 7.28, month: "July 2025" },
            "OEDC": { rate: 6.05, month: "July 2025" },
            "SFELAPCO": { rate: 5.23, month: "July 2025" },
            "ΤΕΙ": { rate: 5.58, month: "July 2025" },
            "BLCI": { rate: 5.87, month: "May 2025" },
            "CENECO/NEPC": { rate: 6.54, month: "July 2025" },
            "MECO": { rate: 5.25, month: "May 2025" },
            "MORE Power": { rate: 4.63, month: "July 2025" },
            "VECO": { rate: 5.54, month: "July 2025" },
            "CEPALCO": { rate: 6.97, month: "February 2025" },
            "CLPC": { rate: 3.85, month: "July 2025" },
            "DLPC": { rate: 4.37, month: "June 2025" },
            "ILPI": { rate: 6.07, month: "July 2025" },
            "BENECO": { rate: 5.88, month: "July 2025" },
            "IFELCO": { rate: 4.35, month: "July 2025" },
            "KAELCO": { rate: 5.31, month: "May 2025" },
            "MOPRECO": { rate: 4.86, month: "May 2025" },
            "CENPELCO": { rate: 5.88, month: "July 2025" },
            "INEC": { rate: 6.27, month: "July 2025" },
            "ISECO": { rate: 5.69, month: "July 2025" },
            "LUELCO": { rate: 8.39, month: "June 2025" },
            "PANELCO Ι": { rate: 4.66, month: "June 2025" },
            "PANELCO III": { rate: 6.06, month: "June 2025" },
            "CAGELCO Ι": { rate: 5.64, month: "June 2025" },
            "CAGELCO II": { rate: 5.3, month: "June 2025" },
            "ISELCO I": { rate: 4.2, month: "July 2025" },
            "ISELCO II": { rate: 4.65, month: "July 2025" },
            "NEECO I": { rate: 4.38, month: "July 2025" },
            "NEECO II AREA I": { rate: 4.19, month: "June 2025" },
            "NEECO II AREA II": { rate: 5.74, month: "July 2025" },
            "PELCO I": { rate: 4.88, month: "June 2025" },
            "PELCO II": { rate: 5.52, month: "July 2025" },
            "PELCO III": { rate: 6.77, month: "July 2025" },
            "PENELCO": { rate: 4.18, month: "June 2025" },
            "PRESCO": { rate: 5.4, month: "July 2025" },
            "SAJELCO": { rate: 5.31, month: "July 2025" },
            "TARELCOΙ": { rate: 5.04, month: "June 2025" },
            "TARELCO II": { rate: 5.04, month: "June 2025" },
            "ZAMECO I": { rate: 4.21, month: "June 2025" },
            "ZAMECO II": { rate: 7.66, month: "January 2025" },
            "BATELEC I": { rate: 5.31, month: "July 2025" },
            "BATELEC II": { rate: 5.08, month: "June 2025" },
            "FLECO": { rate: 5.23, month: "July 2025" },
            "QUEZELCO I": { rate: 5.04, month: "June 2025" },
            "QUEZELCO II": { rate: 5.23, month: "June 2025" },
            "ALECO": { rate: 2.35, month: "March 2025" },
            "CANORECO": { rate: 4.46, month: "July 2025" },
            "CASURECO1": { rate: 5.86, month: "May 2025" },
            "CASURECO2": { rate: 4.02, month: "July 2025" },
            "CASURECO3": { rate: 4.74, month: "July 2025" },
            "CASURECO4": { rate: 4.67, month: "July 2025" },
            "SORECO1": { rate: 4.85, month: "July 2025" },
            "SORECO2": { rate: 4.85, month: "July 2025" },
            "AKELCO": { rate: 6.36, month: "July 2025" },
            "ANTECO": { rate: 5.52, month: "July 2025" },
            "CAPELCO": { rate: 6.29, month: "June 2025" },
            "GUIMELCO": { rate: 5.61, month: "June 2025" },
            "ILECO I": { rate: 5.41, month: "June 2025" },
            "ILECO II": { rate: 5.48, month: "June 2025" },
            "ILECO III": { rate: 5.87, month: "June 2025" },
            "NOCECO": { rate: 6.64, month: "June 2025" },
            "BOHECO I": { rate: 5.21, month: "June 2025" },
            "NONECO": { rate: 5.26, month: "May 2025" },
            "BOHECO II": { rate: 5.33, month: "June 2025" },
            "CEBECO I": { rate: 4.7, month: "July 2025" },
            "CEBECO II": { rate: 5.57, month: "July 2025" },
            "CEBECO III": { rate: 5.32, month: "July 2025" },
            "NORECO IΙ": { rate: 5.59, month: "July 2025" },
            "NORECO II": { rate: 5.68, month: "July 2025" },
            "BILECO": { rate: 5.24, month: "July 2025" },
            "ESAMELCO": { rate: 6.19, month: "June 2025" },
            "LEYECO I": { rate: 6.49, month: "June 2025" },
            "LEYECO II": { rate: 6.02, month: "June 2025" },
            "LEYECO III": { rate: 5.38, month: "June 2025" },
            "LEYECO IV": { rate: 5.51, month: "June 2025" },
            "LEYECO V": { rate: 5.53, month: "June 2025" },
            "NORSAMELCO": { rate: 5.44, month: "July 2025" },
            "SAMELCO Ι": { rate: 5.26, month: "July 2025" },
            "SAMELCO II": { rate: 5.5, month: "July 2025" },
            "SOLECO": { rate: 6.21, month: "May 2025" },
            "ZAMCELCO": { rate: 6.14, month: "July 2025" },
            "ZAMSURECO II": { rate: 4.62, month: "June 2025" },
            "ZANECO": { rate: 5.02, month: "July 2025" },
            "BUSECO": { rate: 5.37, month: "May 2025" },
            "CAMELCO": { rate: 7.01, month: "May 2025" },
            "FIBECO": { rate: 7.09, month: "June 2025" },
            "LANECO": { rate: 5.72, month: "July 2025" },
            "MORESCO I": { rate: 6.74, month: "July 2025" },
            "MORESCO II": { rate: 6.45, month: "July 2025" },
            "DANECO": { rate: 6.64, month: "June 2025" },
            "DASURECO": { rate: 6.1, month: "June 2025" },
            "DORECO": { rate: 6.23, month: "July 2025" },
            "COTELCO": { rate: 5.72, month: "July 2025" },
            "PPALMA": { rate: 5.19, month: "June 2025" },
            "SOCOTECO I": { rate: 5.49, month: "June 2025" },
            "SOCOTECO II": { rate: 5.37, month: "June 2025" },
            "SUKELCO": { rate: 5.54, month: "June 2025" }
        };

        // --- Global state for calculator ---
        let isEligible = false;
        let savedGroupMembers = 10;
        let savedConsumptionPerMember = 400;

        // --- DOM Element Selection ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        // Savings Calculator elements
        const savingsEligibilityStatus = document.getElementById('savings-eligibility-status');
        const savingsMembersDisplay = document.getElementById('savings-members-display');
        const savingsConsumptionDisplay = document.getElementById('savings-consumption-display');
        const currentRateInput = document.getElementById('current-rate');
        const newRateInput = document.getElementById('new-rate');
        const monthlySavingsEl = document.getElementById('monthly-savings');
        const annualSavingsEl = document.getElementById('annual-savings');
        const memberSavingsEl = document.getElementById('member-savings');
        const chartCanvas = document.getElementById('savingsChart');
        const negativeSavingsRecommendationEl = document.getElementById('negative-savings-recommendation');
        const printSavingsReportBtn = document.getElementById('print-savings-report-btn');
        const duSelect = document.getElementById('du-select');
        const duDataMonth = document.getElementById('du-data-month');
        const projectionPeriodSelect = document.getElementById('projection-period');
        const annualIncreaseInput = document.getElementById('annual-increase');
        const projectionResultsEl = document.getElementById('projection-results');
        
        // Eligibility Checker elements
        const eligibilityMembersInput = document.getElementById('eligibility-members');
        const eligibilityMembersValue = document.getElementById('eligibility-members-value');
        const peakDemandInput = document.getElementById('peak-demand');
        const monthlyConsumptionInput = document.getElementById('monthly-consumption');
        const checkEligibilityBtn = document.getElementById('check-eligibility-btn');
        const eligibilityResultEl = document.getElementById('eligibility-result');
        const customerTypeRadios = document.querySelectorAll('input[name="customerType"]');
        const inputTypeRadios = document.querySelectorAll('input[name="inputType"]');
        const kwInputContainer = document.getElementById('kw-input-container');
        const kwhInputContainer = document.getElementById('kwh-input-container');
        const industryTypeContainer = document.getElementById('industry-type-container');
        const industryTypeSelect = document.getElementById('industry-type');

        // Supplier Directory elements
        const supplierListEl = document.getElementById('supplier-list');
        const sortSuppliersSelect = document.getElementById('sort-suppliers');
        const filterStandingSelect = document.getElementById('filter-standing');
        
        // Compare Suppliers elements
        const compareSupplierSelects = document.querySelectorAll('.compare-supplier-select');
        const compareBtn = document.getElementById('compare-suppliers-btn');
        const comparisonResultsEl = document.getElementById('comparison-results');
        const top3ListEl = document.getElementById('top-3-list');
        const finalRecommendationEl = document.getElementById('final-recommendation');
        const printCompareReportBtn = document.getElementById('print-compare-report-btn');

        // FAQ & Info elements
        const glossaryListEl = document.getElementById('glossary-list');
        
        // Notification Modal
        const notificationModal = document.getElementById('notification-modal');
        const notificationMessage = document.getElementById('notification-message');


        let savingsChart;
        
        // --- Chart.js Logic ---
        const centerTextPlugin = { id: 'centerText', afterDraw: (chart) => { if (chart.config.type !== 'doughnut' || !chart.config.options.plugins.centerText?.display) return; const ctx = chart.ctx; const { top, left, width, height } = chart.chartArea; const { text, color, font } = chart.config.options.plugins.centerText; ctx.save(); ctx.font = font || '16px sans-serif'; ctx.fillStyle = color || '#000'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; const textX = left + width / 2; const textY = top + height / 2; ctx.fillText(text, textX, textY); ctx.restore(); } };
        Chart.register(centerTextPlugin);

        function initializeChart() {
            if (savingsChart) {
                savingsChart.destroy();
            }
            const ctx = chartCanvas.getContext('2d');
            savingsChart = new Chart(ctx, {
                type: 'doughnut',
                data: { labels: ['New Monthly Cost', 'Monthly Savings'], datasets: [{ data: [1, 0], backgroundColor: ['#3b82f6', '#22c55e'], borderColor: '#f9fafb', borderWidth: 4, hoverOffset: 8 }] },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '70%',
                    animation: false, // Important for PDF rendering
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, usePointStyle: true, pointStyle: 'rectRounded' } },
                        tooltip: { callbacks: { label: (ctx) => `${ctx.label || ''}: ₱${ctx.parsed.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}` } },
                        centerText: { display: true, text: '0%', color: '#1f2937', font: 'bold 2rem Inter, sans-serif' }
                    }
                }
            });
        }

        // --- Core Logic Functions ---
        const formatCurrency = (value) => {
            const options = { minimumFractionDigits: 2, maximumFractionDigits: 2 };
            return `₱${(value || 0).toLocaleString(undefined, options)}`;
        };

        function calculateAndDisplaySavings() {
            negativeSavingsRecommendationEl.classList.add('hidden');
            if (!isEligible) {
                monthlySavingsEl.textContent = '₱0.00';
                annualSavingsEl.textContent = '₱0.00';
                memberSavingsEl.textContent = '₱0.00';
                
                savingsChart.data.datasets[0].data = [1, 0];
                savingsChart.config.options.plugins.centerText.text = 'N/A';
                savingsChart.config.options.plugins.centerText.color = '#6b7280';
                savingsChart.update();
                
                return;
            }

            const members = savedGroupMembers;
            const consumption = savedConsumptionPerMember;
            const currentRate = parseFloat(currentRateInput.value);
            const newRate = parseFloat(newRateInput.value);

            if (isNaN(members) || isNaN(consumption) || isNaN(currentRate) || isNaN(newRate) || members <= 0 || currentRate <= 0) return;

            const totalConsumption = members * consumption;
            const currentCost = totalConsumption * currentRate;
            const newCost = totalConsumption * newRate;
            
            const monthlySavings = currentCost - newCost;
            const annualSavings = monthlySavings * 12;
            const memberSavings = monthlySavings / members;
            const percentageSavings = (currentCost > 0) ? (monthlySavings / currentCost) * 100 : 0;

            monthlySavingsEl.textContent = formatCurrency(monthlySavings);
            annualSavingsEl.textContent = formatCurrency(annualSavings);
            memberSavingsEl.textContent = formatCurrency(memberSavings);

            if (annualSavings < 0) {
                annualSavingsEl.classList.remove('text-green-600');
                annualSavingsEl.classList.add('text-red-600');
                showNegativeSavingsRecommendation();
            } else {
                annualSavingsEl.classList.remove('text-red-600');
                annualSavingsEl.classList.add('text-green-600');
            }

            savingsChart.data.datasets[0].data = [newCost > 0 ? newCost : 0, monthlySavings > 0 ? monthlySavings : 0];
            const percentageText = isNaN(percentageSavings) || !isFinite(percentageSavings) ? '0' : percentageSavings.toFixed(1);
            savingsChart.config.options.plugins.centerText.text = `${percentageText}%`;
            savingsChart.config.options.plugins.centerText.color = monthlySavings >= 0 ? '#16a34a' : '#dc2626';
            savingsChart.update();
            
            calculateProjections();

        }

        function showNegativeSavingsRecommendation() {
            const topSuppliers = supplierData.slice(0, 5);
            let recommendationHTML = `
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.031-1.742 3.031H4.42c-1.532 0-2.492-1.697-1.742-3.031l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-700">
                                Your potential aggregated rate results in a loss. Consider choosing a supplier with a lower rate. Here are the top 5 with the lowest rates:
                            </p>
                            <ul class="mt-2 text-sm text-yellow-700 list-disc list-inside">
            `;
            topSuppliers.forEach(s => {
                recommendationHTML += `<li><strong>${s.name}</strong>: ${formatCurrency(s.price)}/kWh (ERC: ${s.standing})</li>`;
            });
            recommendationHTML += `
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            negativeSavingsRecommendationEl.innerHTML = recommendationHTML;
            negativeSavingsRecommendationEl.classList.remove('hidden');
        }

        function checkEligibility() {
            const members = parseInt(eligibilityMembersInput.value, 10);
            const threshold = 500; // 500 kW threshold from ERC rules
            const customerType = document.querySelector('input[name="customerType"]:checked').value;
            const inputType = document.querySelector('input[name="inputType"]:checked').value;
            const residentialLoadFactor = 0.231481481;
            
            let peakDemandPerMember = 0;
            let consumptionPerMember = 0;
            let calculationNote = '';

            if (inputType === 'kw') {
                peakDemandPerMember = parseFloat(peakDemandInput.value);
                if (customerType === 'residential') {
                    consumptionPerMember = peakDemandPerMember * 30 * 24 * residentialLoadFactor;
                    calculationNote = `<p class="mt-2 text-xs text-blue-600">Based on a standard residential profile, a peak demand of ${peakDemandPerMember.toFixed(2)} kW is estimated to be equivalent to a monthly consumption of ${consumptionPerMember.toLocaleString(undefined, {maximumFractionDigits: 0})} kWh.</p>`;
                } else {
                    const selectedIndustry = industryTypeSelect.value;
                    const loadFactor = industryLoadFactors[selectedIndustry];
                    consumptionPerMember = peakDemandPerMember * 24 * 30 * (loadFactor || 0.4);
                }
            } else { // kWh input
                consumptionPerMember = parseFloat(monthlyConsumptionInput.value);
                if (isNaN(consumptionPerMember) || consumptionPerMember <= 0) {
                     eligibilityResultEl.innerHTML = `<p class="text-red-500 font-bold">Please enter a valid monthly consumption.</p>`;
                     eligibilityResultEl.classList.remove('hidden');
                     return;
                }

                if (customerType === 'residential') {
                    peakDemandPerMember = (consumptionPerMember / (30 * 24)) / residentialLoadFactor;
                    calculationNote = `<p class="mt-2 text-xs text-blue-600">Based on a standard residential profile, ${consumptionPerMember.toLocaleString()} kWh/month is estimated to be equivalent to a peak demand of ${peakDemandPerMember.toFixed(2)} kW.</p>`;
                } else { // Non-residential
                    const selectedIndustry = industryTypeSelect.value;
                    const loadFactor = industryLoadFactors[selectedIndustry];
                    if (loadFactor) {
                        peakDemandPerMember = (consumptionPerMember / (30 * 24)) / loadFactor;
                        calculationNote = `<p class="mt-2 text-xs text-blue-600">For the '${selectedIndustry}' industry (Load Factor: ${loadFactor}), ${consumptionPerMember.toLocaleString()} kWh/month is estimated to be equivalent to a peak demand of ${peakDemandPerMember.toFixed(2)} kW.</p>`;
                    } else {
                        eligibilityResultEl.innerHTML = `<p class="text-red-500 font-bold">Please select a valid industry.</p>`;
                        eligibilityResultEl.classList.remove('hidden');
                        return;
                    }
                }
            }

            if (isNaN(members) || isNaN(peakDemandPerMember) || members <= 0 || peakDemandPerMember < 0) {
                eligibilityResultEl.innerHTML = `<p class="text-red-500 font-bold">Please enter valid numbers for all fields.</p>`;
                eligibilityResultEl.classList.remove('hidden');
                return;
            }

            const totalDemand = members * peakDemandPerMember;
            let resultHTML = '';

            if (totalDemand >= threshold) {
                isEligible = true;
                resultHTML = `
                    <svg class="w-16 h-16 mx-auto text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h3 class="text-xl font-bold text-green-600 mt-4">Congratulations!</h3>
                    <p class="mt-2 text-gray-600">Your group's estimated total peak demand is <strong class="text-gray-800">${totalDemand.toFixed(1)} kW</strong>, which meets the ${threshold} kW threshold.</p>
                    ${calculationNote}
                    <p class="mt-4 text-sm">You are likely eligible for the Retail Aggregation Program.</p>
                `;
                savingsEligibilityStatus.innerHTML = 'Your group is <span class="text-green-600">eligible</span> for potential savings.';
                savingsEligibilityStatus.className = 'mt-4 mb-6 p-4 rounded-lg text-center font-semibold bg-green-50 text-green-800';
            } else {
                isEligible = false;
                const percentageOfThreshold = (totalDemand / threshold) * 100;
                resultHTML = `
                    <svg class="w-16 h-16 mx-auto text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
                    <h3 class="text-xl font-bold text-yellow-600 mt-4">More Members Needed</h3>
                    <p class="mt-2 text-gray-600">Your group's estimated total peak demand is <strong class="text-gray-800">${totalDemand.toFixed(1)} kW</strong>. This is below the required ${threshold} kW threshold.</p>
                    <p class="mt-1 text-gray-600">This constitutes <strong class="text-gray-800">${percentageOfThreshold.toFixed(1)}%</strong> of the minimum requirement.</p>
                    ${calculationNote}
                    <p class="mt-4 text-sm">Consider adding more members to your group to qualify.</p>
                `;
                savingsEligibilityStatus.innerHTML = 'Your group is currently <span class="text-red-600">not eligible</span>. Savings cannot be calculated.';
                savingsEligibilityStatus.className = 'mt-4 mb-6 p-4 rounded-lg text-center font-semibold bg-red-50 text-red-800';
            }
            eligibilityResultEl.innerHTML = resultHTML;
            eligibilityResultEl.classList.remove('hidden');

            // Save the data for the savings calculator
            savedGroupMembers = members;
            savedConsumptionPerMember = consumptionPerMember;
            savingsMembersDisplay.textContent = savedGroupMembers;
            savingsConsumptionDisplay.textContent = savedConsumptionPerMember.toLocaleString(undefined, {maximumFractionDigits: 0});
            calculateAndDisplaySavings();
        }

        function populateSuppliers(suppliersToDisplay) {
            supplierListEl.innerHTML = '';
            suppliersToDisplay.forEach(supplier => {
                const standingColor = supplier.standing === 'Very Satisfactory' ? 'text-green-600 bg-green-100' : 'text-yellow-600 bg-yellow-100';
                const cardHTML = `
                    <div class="border border-gray-200 rounded-lg p-4 flex flex-col">
                        <h4 class="font-bold text-gray-800">${supplier.name}</h4>
                        <p class="text-sm text-gray-500">${supplier.contact}</p>
                        <div class="my-3">
                            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full ${standingColor}">
                                ERC: ${supplier.standing}
                            </span>
                        </div>
                        <div class="mt-auto">
                            <p class="text-2xl font-extrabold text-blue-600">${formatCurrency(supplier.price)}<span class="text-sm font-medium text-gray-500">/kWh</span></p>
                            <button class="use-rate-btn w-full mt-3 bg-blue-100 text-blue-700 font-semibold px-4 py-2 rounded-lg hover:bg-blue-200 transition-colors" data-price="${supplier.price}">Use Rate</button>
                        </div>
                    </div>
                `;
                supplierListEl.innerHTML += cardHTML;
            });
        }
        
        function updateSupplierList() {
            const sortBy = sortSuppliersSelect.value;
            const filterBy = filterStandingSelect.value;

            let filteredSuppliers = [...supplierData];

            if (filterBy !== 'all') {
                filteredSuppliers = filteredSuppliers.filter(s => s.standing === filterBy);
            }

            if (sortBy === 'price') {
                filteredSuppliers.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'name') {
                filteredSuppliers.sort((a, b) => a.name.localeCompare(b.name));
            }

            populateSuppliers(filteredSuppliers);
        }

        function populateIndustryOptions() {
            const industries = Object.keys(industryLoadFactors);
            industries.sort();
            industryTypeSelect.innerHTML = '<option value="" disabled selected>-- Select your industry --</option>';
            industries.forEach(industry => {
                const option = document.createElement('option');
                option.value = industry;
                option.textContent = industry;
                industryTypeSelect.appendChild(option);
            });
        }

        function populateFAQ() {
            const accordion = document.getElementById('faq-accordion');
            accordion.innerHTML = '';
            faqData.forEach((item, index) => {
                const faqItem = document.createElement('div');
                faqItem.className = 'border border-gray-200 rounded-lg';
                faqItem.innerHTML = `
                    <button class="faq-question w-full text-left p-4 flex justify-between items-center focus:outline-none">
                        <span class="font-semibold text-gray-800">${item.question}</span>
                        <svg class="w-5 h-5 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    <div class="faq-answer px-4 pb-4 text-gray-600">
                        <p>${item.answer}</p>
                    </div>
                `;
                accordion.appendChild(faqItem);
            });
        }

        function populateGlossary() {
            glossaryListEl.innerHTML = '';
            for (const term in glossaryData) {
                const dt = document.createElement('dt');
                dt.className = 'font-semibold text-gray-800';
                dt.textContent = term;
                const dd = document.createElement('dd');
                dd.className = 'mb-2';
                dd.textContent = glossaryData[term];
                glossaryListEl.appendChild(dt);
                glossaryListEl.appendChild(dd);
            }
        }

        function setupFAQAccordion() {
            const accordion = document.getElementById('faq-accordion');
            accordion.addEventListener('click', (event) => {
                const question = event.target.closest('.faq-question');
                if (question) {
                    const answer = question.nextElementSibling;
                    const icon = question.querySelector('svg');
                    
                    // Close all other open answers
                    const allAnswers = accordion.querySelectorAll('.faq-answer');
                    allAnswers.forEach(ans => {
                        if (ans !== answer && ans.style.maxHeight) {
                            ans.style.maxHeight = null;
                            ans.previousElementSibling.classList.remove('text-blue-600');
                            ans.previousElementSibling.querySelector('svg').classList.remove('rotate-180');
                        }
                    });

                    // Toggle the clicked one
                    question.classList.toggle('text-blue-600');
                    icon.classList.toggle('rotate-180');

                    if (answer.style.maxHeight) {
                        answer.style.maxHeight = null;
                    } else {
                        answer.style.maxHeight = answer.scrollHeight + "px";
                    }
                }
            });
        }

        function toggleEligibilityInputs() {
            const customerType = document.querySelector('input[name="customerType"]:checked').value;
            const inputType = document.querySelector('input[name="inputType"]:checked').value;

            if (inputType === 'kw') {
                kwInputContainer.classList.remove('hidden');
                kwhInputContainer.classList.add('hidden');
                industryTypeContainer.classList.add('hidden');
            } else { // kWh
                kwInputContainer.classList.add('hidden');
                kwhInputContainer.classList.remove('hidden');
                if (customerType === 'non-residential') {
                    industryTypeContainer.classList.remove('hidden');
                } else {
                    industryTypeContainer.classList.add('hidden');
                }
            }
        }
        
        function populateCompareSuppliers() {
            compareSupplierSelects.forEach(select => {
                select.innerHTML = '<option value="">Select a supplier</option>';
                supplierData.forEach(supplier => {
                    const option = document.createElement('option');
                    option.value = supplier.name;
                    option.textContent = `${supplier.name} (${formatCurrency(supplier.price)}/kWh)`;
                    select.appendChild(option);
                });
            });
        }

        function compareSuppliers() {
            const selectedSuppliers = [];
            const selectedNames = new Set();
            compareSupplierSelects.forEach(select => {
                if (select.value && !selectedNames.has(select.value)) {
                    const supplier = supplierData.find(s => s.name === select.value);
                    if (supplier) {
                        selectedSuppliers.push(supplier);
                        selectedNames.add(select.value);
                    }
                }
            });

            if (selectedSuppliers.length === 0) {
                comparisonResultsEl.innerHTML = '<p class="text-red-500">Please select at least one supplier to compare.</p>';
                return;
            }

            let resultsHTML = '<div class="grid grid-cols-1 md:grid-cols-3 gap-6">';
            selectedSuppliers.forEach(supplier => {
                const annualSavings = (parseFloat(currentRateInput.value) - supplier.price) * savedConsumptionPerMember * 12 * savedGroupMembers;
                const savingsColor = annualSavings >= 0 ? 'text-green-600' : 'text-red-600';
                resultsHTML += `
                    <div class="border rounded-lg p-4 text-center">
                        <h4 class="font-bold text-lg">${supplier.name}</h4>
                        <p class="text-sm text-gray-500">ERC Standing: ${supplier.standing}</p>
                        <p class="text-2xl font-bold ${savingsColor} mt-2">${formatCurrency(annualSavings)}</p>
                        <p class="text-sm text-gray-500">Potential Annual Savings</p>
                    </div>
                `;
            });
            resultsHTML += '</div>';
            comparisonResultsEl.innerHTML = resultsHTML;
        }

        function showTop3Recommendation() {
            const top3 = supplierData.slice(0, 3);
            let top3HTML = '';
            top3.forEach(supplier => {
                const annualSavings = (parseFloat(currentRateInput.value) - supplier.price) * savedConsumptionPerMember * 12 * savedGroupMembers;
                top3HTML += `
                    <div class="border rounded-lg p-4 flex justify-between items-center">
                        <div>
                            <h4 class="font-bold text-lg">${supplier.name}</h4>
                            <p class="text-sm text-gray-500">ERC Standing: ${supplier.standing}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-bold text-green-600">${formatCurrency(annualSavings)}</p>
                            <p class="text-sm text-gray-500">Potential Annual Savings</p>
                        </div>
                    </div>
                `;
            });
            top3ListEl.innerHTML = top3HTML;

            const bestSupplier = top3[0];
            const bestSavings = (parseFloat(currentRateInput.value) - bestSupplier.price) * savedConsumptionPerMember * 12 * savedGroupMembers;
            let finalRecHTML = `
                <p class="text-lg font-semibold text-green-800">Recommendation</p>
                <p class="text-green-700">Based on the lowest rate, <strong>${bestSupplier.name}</strong> is the top recommendation with potential annual savings of <strong>${formatCurrency(bestSavings)}</strong>.</p>
            `;
            finalRecommendationEl.innerHTML = finalRecHTML;
            finalRecommendationEl.classList.remove('hidden');
        }
        
        // --- New Feature Functions ---

        function showNotification(message, isError = false) {
            notificationMessage.textContent = message;
            notificationModal.classList.remove('bg-green-500', 'bg-red-500', 'opacity-0', 'translate-y-10');
            notificationModal.classList.add(isError ? 'bg-red-500' : 'bg-green-500', 'opacity-100', 'translate-y-0');

            setTimeout(() => {
                notificationModal.classList.remove('opacity-100', 'translate-y-0');
                notificationModal.classList.add('opacity-0', 'translate-y-10');
            }, 3000);
        }

        async function generatePdfReport(elementId, fileName) {
            const { jsPDF } = window.jspdf;
            const reportElement = document.getElementById(elementId);
            
            showNotification('Generating PDF report...');

            try {
                const canvas = await html2canvas(reportElement, { 
                    scale: 2, 
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });
                const imgData = canvas.toDataURL('image/png');
                
                const pdf = new jsPDF({
                    orientation: 'p',
                    unit: 'mm',
                    format: 'a4'
                });

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save(fileName);
            } catch (error) {
                console.error("Error generating PDF:", error);
                showNotification("Failed to generate PDF.", true);
            }
        }
        
        function populateDuSelect() {
            duSelect.innerHTML = '<option value="">Select a DU or enter rate manually</option>';
            for (const duName in duData) {
                const option = document.createElement('option');
                option.value = duName;
                option.textContent = duName;
                duSelect.appendChild(option);
            }
        }

        function calculateProjections() {
            const period = parseFloat(projectionPeriodSelect.value);
            const increase = parseFloat(annualIncreaseInput.value) / 100;
            const monthlySavings = (parseFloat(currentRateInput.value) - parseFloat(newRateInput.value)) * savedConsumptionPerMember * savedGroupMembers;

            if (isNaN(monthlySavings) || !isEligible) {
                projectionResultsEl.innerHTML = '';
                return;
            }

            let totalSavings = 0;
            let tableHTML = `
                <div class="overflow-x-auto">
                    <table class="w-full text-left border-collapse">
                        <thead>
                            <tr>
                                <th class="py-2 px-4 border-b">Year</th>
                                <th class="py-2 px-4 border-b text-right">Projected Annual Savings</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            for (let i = 1; i <= Math.floor(period); i++) {
                const annualSavings = monthlySavings * 12 * Math.pow(1 + increase, i - 1);
                totalSavings += annualSavings;
                tableHTML += `
                    <tr>
                        <td class="py-2 px-4 border-b">Year ${i}</td>
                        <td class="py-2 px-4 border-b text-right">${formatCurrency(annualSavings)}</td>
                    </tr>
                `;
            }

            if (period % 1 !== 0) {
                const partialYearSavings = (monthlySavings * 12 * Math.pow(1 + increase, Math.floor(period))) * 0.5;
                totalSavings += partialYearSavings;
                tableHTML += `
                    <tr>
                        <td class="py-2 px-4 border-b">Year ${Math.ceil(period)} (6 months)</td>
                        <td class="py-2 px-4 border-b text-right">${formatCurrency(partialYearSavings)}</td>
                    </tr>
                `;
            }

            tableHTML += `
                        </tbody>
                        <tfoot>
                            <tr class="font-bold">
                                <td class="py-3 px-4 border-t">Total Projected Savings</td>
                                <td class="py-3 px-4 border-t text-right text-green-600 text-lg">${formatCurrency(totalSavings)}</td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            `;

            projectionResultsEl.innerHTML = tableHTML;
        }

        function populateProjectionPeriod() {
            for (let i = 1; i <= 5; i += 0.5) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i} Year(s)`;
                projectionPeriodSelect.appendChild(option);
            }
        }

        function populateAnnualIncrease() {
            for (let i = -1; i <= 7; i += 0.5) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `${i.toFixed(1)}%`;
                annualIncreaseInput.appendChild(option);
            }
            annualIncreaseInput.value = "0";
        }


        // --- Event Listeners ---
        function setupEventListeners() {
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetTab = button.dataset.tab;

                    tabButtons.forEach(btn => {
                        btn.classList.remove('active', 'text-blue-600', 'border-blue-600', 'bg-eff6ff');
                        btn.classList.add('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');
                    });
                    button.classList.add('active', 'text-blue-600', 'border-blue-600', 'bg-eff6ff');
                    button.classList.remove('text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300');

                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `${targetTab}-content`) {
                            content.classList.add('active');
                        }
                    });
                });
            });

            const savingsCalculatorInputs = [currentRateInput, newRateInput, projectionPeriodSelect, annualIncreaseInput];
            savingsCalculatorInputs.forEach(input => input.addEventListener('input', () => {
                calculateAndDisplaySavings();
            }));

            eligibilityMembersInput.addEventListener('input', (e) => {
                eligibilityMembersValue.textContent = e.target.value;
                calculateProjections();
            });
            checkEligibilityBtn.addEventListener('click', checkEligibility);
            
            customerTypeRadios.forEach(radio => radio.addEventListener('change', toggleEligibilityInputs));
            inputTypeRadios.forEach(radio => radio.addEventListener('change', toggleEligibilityInputs));

            supplierListEl.addEventListener('click', (e) => {
                if (e.target.classList.contains('use-rate-btn')) {
                    const price = e.target.dataset.price;
                    newRateInput.value = parseFloat(price).toFixed(2);
                    calculateAndDisplaySavings();
                    // Switch to savings tab
                    document.querySelector('.tab-button[data-tab="savings"]').click();
                    window.scrollTo({ top: document.getElementById('calculator').offsetTop, behavior: 'smooth' });
                }
            });
            
            compareBtn.addEventListener('click', compareSuppliers);
            
            printSavingsReportBtn.addEventListener('click', () => generatePdfReport('savings-report-area', 'rap-savings-report.pdf'));
            printCompareReportBtn.addEventListener('click', () => generatePdfReport('compare-report-area', 'rap-comparison-report.pdf'));
            
            sortSuppliersSelect.addEventListener('change', updateSupplierList);
            filterStandingSelect.addEventListener('change', updateSupplierList);

            duSelect.addEventListener('change', () => {
                const selectedDu = duSelect.value;
                if (selectedDu && duData[selectedDu]) {
                    currentRateInput.value = duData[selectedDu].rate.toFixed(2);
                    duDataMonth.textContent = `Latest data from ${duData[selectedDu].month}`;
                    calculateAndDisplaySavings();
                } else {
                    duDataMonth.textContent = '';
                }
            });

        }

        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            initializeChart();
            updateSupplierList(); // Use this instead of populateSuppliers directly
            populateIndustryOptions();
            populateFAQ();
            populateGlossary();
            populateCompareSuppliers();
            populateDuSelect();
            populateProjectionPeriod();
            populateAnnualIncrease();
            setupEventListeners();
            setupFAQAccordion();
            showTop3Recommendation();
            
            // Set initial display values on savings tab and check eligibility
            checkEligibility();
            
            // Set eligibility slider value on load
            eligibilityMembersValue.textContent = eligibilityMembersInput.value;
            
            // Set Meralco as default
            duSelect.value = "MERALCO";
            duSelect.dispatchEvent(new Event('change'));
        });
    </script>
</body>
</html>
